{{> head title=title}}
<body>
  {{> nav}}
  <div class="page">
    <div class="container">
      {{#if status}}
        <div class="status-message">{{status}}</div>
      {{/if}}
      {{#if token}}
        <div class="status-message">
          <strong>Device token:</strong>
          <code>{{token}}</code>
          <br />
          Share this with installers securely. It will not be shown again.
        </div>
      {{/if}}

      <div class="card">
        <h2>{{device.displayName}}</h2>
        <p>
          <strong>Status:</strong> {{device.status}}<br />
          <strong>Allowed package:</strong> {{device.allowedPackage}}<br />
          <strong>Last check-in:</strong>
          {{#if device.lastCheckIn}}{{device.lastCheckIn}}{{else}}Never{{/if}}<br />
          <strong>Last command:</strong>
          {{#if device.lastCommandAt}}{{device.lastCommandAt}}{{else}}None{{/if}}
        </p>

        <div class="actions">
          <form method="post" action="/dashboard/devices/{{device.id}}/commands/pin">
            <div class="form-group">
              <label for="pin">Rotate PIN</label>
              <input type="number" id="pin" name="pin" minlength="4" required />
            </div>
            <button type="submit">Queue PIN Update</button>
          </form>

          <form
            method="post"
            action="/dashboard/devices/{{device.id}}/commands/package"
          >
            <div class="form-group">
              <label for="allowedPackage">Allowed package</label>
              <input
                type="text"
                id="allowedPackage"
                name="allowedPackage"
                value="{{device.allowedPackage}}"
                required
              />
            </div>
            <button type="submit">Queue Package Update</button>
          </form>

          <form method="post" action="/dashboard/devices/{{device.id}}/commands/reboot">
            <label>&nbsp;</label>
            <button type="submit" class="danger">Send Reboot</button>
          </form>

          <form method="post" action="/dashboard/devices/{{device.id}}/token">
            <label>&nbsp;</label>
            <button type="submit" class="secondary">Rotate Device Token</button>
          </form>
        </div>
      </div>

      <div class="card">
        <h3>Provisioning Extras</h3>
        <pre>{{{pretty provisioning}}}</pre>
      </div>

      <div class="card">
        <h3>Recent Commands</h3>
        {{#if commands.length}}
          <table>
            <thead>
              <tr>
                <th>Type</th>
                <th>Status</th>
                <th>Created</th>
                <th>Updated</th>
              </tr>
            </thead>
            <tbody>
              {{#each commands}}
                <tr>
                  <td>{{this.type}}</td>
                  <td>{{this.status}}</td>
                  <td>{{this.createdAt}}</td>
                  <td>{{this.updatedAt}}</td>
                </tr>
              {{/each}}
            </tbody>
          </table>
        {{else}}
          <p>No commands queued.</p>
        {{/if}}
      </div>
    </div>
  </div>
{{> footer}}

